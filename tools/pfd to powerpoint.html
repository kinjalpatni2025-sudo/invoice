<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF → PowerPoint (Smarttool Hub)</title>
  <meta name="description" content="Convert a PDF into a PowerPoint where each page becomes a slide image. 100% client-side." />
  <style>
    :root{
      --brand:#003366; --brand-dark:#002244; --bg:#f3f6fb; --card:#fff; --text:#0f172a; --muted:#475569;
    }
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:900px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,.06);padding:20px}
    h1{margin:0 0 6px;color:var(--brand)}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .u-row{display:flex;gap:16px;flex-wrap:wrap}
    .u-col{flex:1 1 260px}
    .label{font-size:.9rem;color:#334155;margin-bottom:6px}
    .select,.input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;font-size:.95rem}
    .btn{display:inline-flex;align-items:center;gap:8px;background:var(--brand);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:hover{background:var(--brand-dark)}
    .muted{color:var(--muted);font-size:.92rem}
    .drop{border:2px dashed #cbd5e1;border-radius:12px;background:#fff;padding:22px;text-align:center;transition:.2s}
    .drop.drag{background:#eef6ff;border-color:#60a5fa}
    .progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:var(--brand);transition:width .2s}
    .thumbs{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px;margin-top:12px}
    .thumb{background:#fff;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden}
    .thumb canvas{width:100%;display:block}
    .tips{margin-top:8px}
    .footer-note{margin-top:18px;font-size:.85rem;color:#64748b}
    @media (max-width:600px){ .btn{width:100%;justify-content:center} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>PDF → PowerPoint</h1>
      <p class="lead">Turn each PDF page into a slide image inside a PPTX. Fully browser-based (no upload).</p>

      <div class="u-row" role="group" aria-label="Conversion options">
        <div class="u-col">
          <div class="label">Slide Size</div>
          <select id="slideSize" class="select" aria-label="Slide size">
            <option value="16x9" selected>Widescreen 16:9 (10 x 5.625 in)</option>
            <option value="4x3">Standard 4:3 (10 x 7.5 in)</option>
            <option value="a4">A4-ish (11.69 x 8.27 in)</option>
          </select>
        </div>
        <div class="u-col">
          <div class="label">Page Margins (inches)</div>
          <input id="margin" class="input" type="number" step="0.1" min="0" value="0.25" aria-label="Margins in inches" />
        </div>
        <div class="u-col">
          <div class="label">Quality (DPI scale)</div>
          <select id="dpi" class="select" aria-label="Image quality / DPI">
            <option value="1">Standard</option>
            <option value="1.5" selected>High</option>
            <option value="2">Very High</option>
          </select>
        </div>
      </div>

      <div class="tips muted">Note: Output slides contain page images (not editable text). Best for sharing/printing.</div>

      <div id="drop" class="drop" tabindex="0" role="button" aria-label="Drop PDF here or use file picker">
        <strong>Drop your PDF here</strong><br/>
        or <label for="file" style="text-decoration:underline;cursor:pointer">choose file</label>
        <input id="file" type="file" accept="application/pdf" style="display:none" />
      </div>

      <div id="status" class="muted" style="margin:10px 0 6px 0;">No file selected.</div>
      <div class="progress" aria-label="Progress">
        <div id="bar" class="bar"></div>
      </div>

      <div id="thumbs" class="thumbs" aria-live="polite" aria-label="Page previews"></div>

      <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
        <button id="convert" class="btn" disabled aria-disabled="true">Convert to PPTX</button>
        <button id="clear" class="btn" style="background:#64748b" disabled aria-disabled="true">Clear</button>
      </div>

      <div class="footer-note">Privacy: All processing is local in your browser. Nothing leaves your device.</div>
    </div>
  </div>

  <!-- libs: pdf.js + PptxGenJS (from CDNs) -->
  <script src="https://unpkg.com/pdfjs-dist@4.4.168/build/pdf.min.js"></script>
  <script src="https://unpkg.com/pptxgenjs@3.12.0/dist/pptxgen.min.js"></script>

  <script>
    // pdf.js worker
    if (window['pdfjsLib']) {
      pdfjsLib.GlobalWorkerOptions.workerSrc = "https://unpkg.com/pdfjs-dist@4.4.168/build/pdf.worker.min.js";
    }

    const $ = sel => document.querySelector(sel);
    const drop = $('#drop');
    const fileInput = $('#file');
    const statusEl = $('#status');
    const bar = $('#bar');
    const thumbs = $('#thumbs');
    const convertBtn = $('#convert');
    const clearBtn = $('#clear');

    let pdfBytes = null;
    let pdfDoc = null;
    let pageCanvases = []; // {page, canvas}

    function setProgress(p) {
      bar.style.width = Math.max(0, Math.min(100, p)) + '%';
    }

    function resetUI() {
      setProgress(0);
      thumbs.innerHTML = '';
      statusEl.textContent = 'No file selected.';
      convertBtn.disabled = true; convertBtn.setAttribute('aria-disabled','true');
      clearBtn.disabled = true; clearBtn.setAttribute('aria-disabled','true');
      pageCanvases = [];
    }

    function enableActions() {
      convertBtn.disabled = false; convertBtn.setAttribute('aria-disabled','false');
      clearBtn.disabled = false; clearBtn.setAttribute('aria-disabled','false');
    }

    async function handleFiles(file) {
      if (!file) return;
      resetUI();
      statusEl.textContent = `Loading: ${file.name} ...`;
      pdfBytes = await file.arrayBuffer();
      try {
        pdfDoc = await pdfjsLib.getDocument({ data: pdfBytes }).promise;
      } catch (e) {
        statusEl.textContent = 'Failed to read PDF. Is the file valid?';
        return;
      }

      const total = pdfDoc.numPages;
      for (let i=1; i<=total; i++) {
        const page = await pdfDoc.getPage(i);
        // Base viewport
        const baseViewport = page.getViewport({ scale: 1 });
        const dpiScale = parseFloat($('#dpi').value || '1.5');
        const scale = dpiScale * (1200 / Math.max(baseViewport.width, baseViewport.height)); // heuristic for quality
        const viewport = page.getViewport({ scale });
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: false });

        canvas.width = Math.ceil(viewport.width);
        canvas.height = Math.ceil(viewport.height);

        await page.render({ canvasContext: ctx, viewport }).promise;

        // Thumbnail
        const thumbWrap = document.createElement('div');
        thumbWrap.className = 'thumb';
        const thumbCanvas = document.createElement('canvas');
        const ratio = 160 / canvas.width;
        thumbCanvas.width = 160;
        thumbCanvas.height = Math.round(canvas.height * ratio);
        thumbWrap.appendChild(thumbCanvas);
        thumbs.appendChild(thumbWrap);
        const tctx = thumbCanvas.getContext('2d');
        tctx.drawImage(canvas, 0, 0, thumbCanvas.width, thumbCanvas.height);

        pageCanvases.push({ page: i, canvas });
        setProgress(Math.round((i/total)*100));
        statusEl.textContent = `Rendered ${i}/${total} pages`;
      }

      enableActions();
      statusEl.textContent = `Ready: ${file.name} (${pdfDoc.numPages} pages)`;
    }

    drop.addEventListener('dragover', e => {
      e.preventDefault(); drop.classList.add('drag');
    });
    drop.addEventListener('dragleave', () => drop.classList.remove('drag'));
    drop.addEventListener('drop', e => {
      e.preventDefault(); drop.classList.remove('drag');
      const f = e.dataTransfer.files?.[0];
      handleFiles(f);
    });
    fileInput.addEventListener('change', e => handleFiles(e.target.files?.[0]));
    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('keydown', e => { if(e.key==='Enter' || e.key===' ') fileInput.click(); });

    clearBtn.addEventListener('click', resetUI);

    convertBtn.addEventListener('click', async () => {
      if (!pdfDoc || pageCanvases.length === 0) return;

      const pptx = new PptxGenJS();

      // Slide sizes
      const sizeSel = $('#slideSize').value;
      if (sizeSel === '16x9') pptx.layout = 'LAYOUT_16x9';  // 10 x 5.625 in
      else if (sizeSel === '4x3') pptx.layout = 'LAYOUT_4x3'; // 10 x 7.5 in
      else { pptx.defineLayout({ name:'A4W', width:11.69, height:8.27 }); pptx.layout = 'A4W'; }

      const margin = Math.max(0, parseFloat($('#margin').value || '0') );
      const slideW = pptx._getLayout(pptx.layout).width;
      const slideH = pptx._getLayout(pptx.layout).height;

      // Build slides
      for (let i=0;i<pageCanvases.length;i++) {
        const { canvas } = pageCanvases[i];
        const dataUrl = canvas.toDataURL('image/jpeg', 0.9);

        // Fit image into slide with margins (letterbox contain)
        const availW = slideW - margin*2;
        const availH = slideH - margin*2;

        // Convert px to inches approximation: 96 px per inch
        const imgW_in = canvas.width / 96;
        const imgH_in = canvas.height / 96;
        const scale = Math.min(availW / imgW_in, availH / imgH_in);

        const w = imgW_in * scale;
        const h = imgH_in * scale;
        const x = (slideW - w) / 2;
        const y = (slideH - h) / 2;

        const slide = pptx.addSlide();
        slide.addImage({ data: dataUrl, x, y, w, h });
      }

      statusEl.textContent = 'Packaging PPTX...';
      setProgress(100);
      const outName = `PDF-to-PPT_${new Date().toISOString().slice(0,10)}.pptx`;
      await pptx.writeFile({ fileName: outName });
      statusEl.textContent = 'Done. Your PPTX has downloaded.';
    });
  </script>
</body>
</html>
