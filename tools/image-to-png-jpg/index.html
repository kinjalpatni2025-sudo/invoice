<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Convert Image to PNG / JPG — Smarttool Hub</title>
<meta name="description" content="Free online image converter: turn images into PNG or JPG entirely in your browser. Batch convert, set quality, resize, preview, and download as ZIP. No upload."/>
<meta name="keywords" content="image to png, image to jpg, jpg converter, png converter, convert images, batch image converter, online image converter, client-side, no upload"/>
<link rel="icon" href="https://img.icons8.com/fluency/48/toolbox.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>

<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --muted:#9aa8bf; --text:#e6eef8;
    --pri1:#6366f1; --pri2:#0ea5e9; --outline:rgba(255,255,255,0.08);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
  header{position:sticky;top:0;z-index:999;background:linear-gradient(90deg,var(--pri1),var(--pri2));padding:12px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 6px 18px rgba(0,0,0,.45)}
  .logo{display:flex;gap:12px;align-items:center}
  .logo img{width:44px;height:44px;border-radius:8px}
  header h1{margin:0;font-size:18px}
  header .right a{background:#fff;color:#0b1220;padding:8px 10px;border-radius:8px;text-decoration:none;font-weight:700}

  .wrap{max-width:1200px;margin:18px auto;padding:12px}
  .grid{display:grid;grid-template-columns:300px 1fr 320px;gap:12px}
  .panel{background:var(--card);border:1px solid var(--outline);border-radius:12px;padding:12px}
  .left{overflow:auto;max-height:70vh}
  .muted{color:var(--muted);font-size:13px}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .btn{background:transparent;border:1px solid var(--outline);color:var(--text);padding:8px 10px;border-radius:8px;cursor:pointer}
  .btn.primary{background:#fff;color:#071124;font-weight:700}
  .btn.small{padding:6px 8px;font-size:13px}

  label.inputbtn{display:inline-flex;align-items:center;gap:8px;cursor:pointer;border:1px dashed var(--outline);padding:8px 10px;border-radius:8px}
  input[type=file]{display:none}
  select,input[type="number"],input[type="text"],input[type="range"],input[type="color"]{
    background:#0b1220;color:var(--text);border:1px solid var(--outline);padding:6px;border-radius:8px
  }

  /* Thumbnails list */
  .item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;align-items:center;padding:8px;border-radius:10px;background:#0e1626;border:1px solid var(--outline);margin-bottom:8px}
  .item.dragging{opacity:.6}
  .thumb{width:64px;height:64px;border-radius:8px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
  .thumb img{max-width:100%;max-height:100%;display:block}
  .item .name{font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .item .size{font-size:12px;color:var(--muted)}
  .item .actions{display:flex;gap:8px}
  .dropzone{border:2px dashed var(--outline);border-radius:12px;padding:12px;text-align:center;margin-top:8px}
  .dropzone.dragover{border-color:#9acbff;background:rgba(13,63,120,.25)}

  /* Stage */
  .stage{position:relative;border-radius:10px;overflow:hidden;border:1px solid var(--outline);background:#0b1220;display:flex;align-items:center;justify-content:center;min-height:520px}
  #preview{max-width:100%;max-height:520px;display:block}
  #placeholder{color:#a9b6cb;text-align:center}

  /* Converted list */
  .list-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px dashed var(--outline)}
  .list-row:last-child{border-bottom:none}

  @media (max-width:1024px){ .grid{grid-template-columns:1fr} .left{max-height:260px} .stage{min-height:420px} }
</style>
</head>
<body>
<header>
  <div class="logo">
    <img src="https://img.icons8.com/fluency/48/toolbox.png" alt="logo">
    <div>
      <h1>Image → PNG / JPG</h1>
      <div style="font-size:12px;color:#e6f7ffcc">Client-side converter • Batch • No uploads</div>
    </div>
  </div>
  <div class="right">
    <a href="../../index.html">← Back to Home</a>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <!-- LEFT: files & list -->
    <aside class="panel left" id="leftPanel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <strong>Images</strong>
        <div class="muted" id="countLabel">0</div>
      </div>
      <div class="controls" style="margin-bottom:10px">
        <label class="inputbtn">
          <i class="fa fa-file-image"></i> Select images
          <input id="fileInput" type="file" accept="image/*" multiple>
        </label>
        <button id="clearBtn" class="btn small">Clear</button>
      </div>
      <div id="dropzone" class="dropzone">Drag & drop images here</div>
      <div class="muted" style="margin:8px 0">Tip: You can drag to reorder. Click an item to preview.</div>
      <div id="list"></div>
    </aside>

    <!-- CENTER: preview & options -->
    <main class="panel" style="display:flex;flex-direction:column;gap:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
        <div class="controls">
          <div class="muted">Format</div>
          <select id="formatSel" style="margin-left:6px">
            <option value="png">PNG (lossless)</option>
            <option value="jpeg">JPG (smaller)</option>
          </select>

          <div class="muted" style="margin-left:12px">Quality</div>
          <input id="quality" type="range" min="30" max="100" value="92" style="width:120px;margin-left:6px">
          <span id="qualityLabel" class="muted">92</span>

          <div class="muted" style="margin-left:12px">Scale</div>
          <select id="scaleSel" style="margin-left:6px">
            <option value="1">1× (original)</option>
            <option value="0.5">0.5×</option>
            <option value="1.5">1.5×</option>
            <option value="2">2×</option>
            <option value="3">3×</option>
          </select>

          <div class="muted" style="margin-left:12px">Background</div>
          <input id="bgColor" type="color" value="#ffffff" title="Fill color for JPG / also for PNG if you want solid bg">
        </div>

        <div class="controls">
          <button id="convertBtn" class="btn primary"><i class="fa fa-wand-magic-sparkles"></i> Convert</button>
          <button id="downloadZipBtn" class="btn small"><i class="fa fa-file-zipper"></i> Download ZIP</button>
        </div>
      </div>

      <div class="stage" id="stage">
        <div id="placeholder">
          <div style="font-size:18px;margin-bottom:8px">Preview</div>
          <div class="muted">Select or drop images to start. Click an item in the list to preview.</div>
        </div>
        <img id="preview" class="hidden" alt="preview">
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <div class="muted">File name pattern:  
          <input id="namePattern" type="text" value="{name}-{i}" style="margin-left:6px;width:240px">
          <span class="muted" style="font-size:12px">Use <code>{i}</code> index, <code>{name}</code> original name (no ext).</span>
        </div>
        <div class="muted" id="status">Idle</div>
      </div>
    </main>

    <!-- RIGHT: per-file actions -->
    <aside class="panel">
      <h3 style="margin:0 0 8px 0">Downloads</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
        <button id="downloadCurrentBtn" class="btn small">Download current</button>
        <button id="downloadAllBtn" class="btn small">Download all</button>
      </div>
      <div id="convertedList" style="max-height:360px;overflow:auto"></div>
      <hr style="border:none;border-top:1px solid var(--outline);margin:12px 0">
      <div class="muted" style="font-size:12px">
        Notes: JPG doesn’t support transparency; we fill transparent regions with the chosen Background color.  
        HEIC/HEIF support depends on the browser.
      </div>
    </aside>
  </div>
</div>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
/* ============ State ============ */
const els = {
  file: qs('#fileInput'), drop: qs('#dropzone'), list: qs('#list'), count: qs('#countLabel'),
  format: qs('#formatSel'), quality: qs('#quality'), qLabel: qs('#qualityLabel'),
  scale: qs('#scaleSel'), bg: qs('#bgColor'),
  preview: qs('#preview'), placeholder: qs('#placeholder'), stage: qs('#stage'),
  status: qs('#status'), namePattern: qs('#namePattern'),
  convert: qs('#convertBtn'), dlZip: qs('#downloadZipBtn'),
  dlCurrent: qs('#downloadCurrentBtn'), dlAll: qs('#downloadAllBtn'),
  clear: qs('#clearBtn'), convList: qs('#convertedList')
};
const items = []; // {id, file, name, type, size, dataURL, imgBitmap}
let current = null; // id of current preview
const converted = new Map(); // id -> {blob, name}

/* ============ Helpers ============ */
function qs(s){return document.querySelector(s)}
function human(n){
  const i = n===0?0:Math.floor(Math.log(n)/Math.log(1024));
  const v = (n/Math.pow(1024,i)).toFixed( (i?1:0) );
  return v+' '+['B','KB','MB','GB'][i];
}
function extOf(fmt){ return fmt==='jpeg' ? 'jpg' : 'png'; }
function baseName(filename){ return filename.replace(/\.[^.]+$/,''); }
function setStatus(t){ els.status.textContent=t; }
function showPreview(url){
  els.preview.src=url; els.preview.classList.remove('hidden'); els.placeholder.classList.add('hidden');
}

/* ============ Load files ============ */
els.file.addEventListener('change', (e)=> handleFiles(e.target.files));
els.drop.addEventListener('dragover', e=>{ e.preventDefault(); els.drop.classList.add('dragover'); });
els.drop.addEventListener('dragleave', ()=> els.drop.classList.remove('dragover'));
els.drop.addEventListener('drop', e=>{
  e.preventDefault(); els.drop.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

async function handleFiles(fileList){
  const files = Array.from(fileList).filter(f=>/^image\//i.test(f.type));
  if(!files.length) return;
  setStatus('Loading '+files.length+' image(s)...');
  for(const f of files){
    const id = crypto.randomUUID();
    const dataURL = await readAsDataURL(f);
    // Try to keep EXIF orientation via createImageBitmap (if supported)
    let imgBitmap=null;
    try{ imgBitmap = await createImageBitmap(await f.arrayBuffer? new Blob([new Uint8Array(await f.arrayBuffer())], {type:f.type}):f, {imageOrientation:'from-image'}); }catch(_){}
    const it = {id, file:f, name:f.name, type:f.type, size:f.size, dataURL, imgBitmap};
    items.push(it);
    addListItem(it);
    if(!current){ current=id; showPreview(dataURL); }
  }
  els.count.textContent = items.length;
  setStatus('Ready');
}

function readAsDataURL(file){
  return new Promise((res,rej)=>{
    const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file);
  });
}

/* ============ List UI ============ */
function addListItem(it){
  const row=document.createElement('div'); row.className='item'; row.draggable=true; row.dataset.id=it.id;

  const th=document.createElement('div'); th.className='thumb';
  const img=new Image(); img.src=it.dataURL; th.appendChild(img);

  const mid=document.createElement('div');
  const nm=document.createElement('div'); nm.className='name'; nm.textContent=it.name;
  const sz=document.createElement('div'); sz.className='size'; sz.textContent=human(it.size);
  mid.appendChild(nm); mid.appendChild(sz);

  const act=document.createElement('div'); act.className='actions';
  const openBtn=document.createElement('button'); openBtn.className='btn small'; openBtn.textContent='Preview';
  openBtn.onclick=()=>{ current=it.id; showPreview(it.dataURL); };

  const rmBtn=document.createElement('button'); rmBtn.className='btn small'; rmBtn.innerHTML='<i class="fa fa-trash"></i>';
  rmBtn.onclick=()=> removeItem(it.id);

  act.appendChild(openBtn); act.appendChild(rmBtn);

  row.appendChild(th); row.appendChild(mid); row.appendChild(act);
  row.addEventListener('dragstart', onDragStart);
  row.addEventListener('dragover', onDragOver);
  row.addEventListener('drop', onDrop);
  row.addEventListener('dragend', onDragEnd);

  els.list.appendChild(row);
}

function removeItem(id){
  const idx=items.findIndex(x=>x.id===id); if(idx<0) return;
  items.splice(idx,1);
  els.list.querySelector(`[data-id="${id}"]`)?.remove();
  converted.delete(id);
  if(current===id){
    current = items[0]?.id || null;
    if(current) showPreview(items[0].dataURL); else { els.preview.classList.add('hidden'); els.placeholder.classList.remove('hidden'); }
  }
  els.count.textContent = items.length;
  renderConvertedList();
}

/* Drag reorder */
let dragId=null;
function onDragStart(e){ dragId=e.currentTarget.dataset.id; e.currentTarget.classList.add('dragging'); }
function onDragOver(e){ e.preventDefault(); const over=e.currentTarget; if(!dragId || over.dataset.id===dragId) return; }
function onDrop(e){
  e.preventDefault();
  const targetId=e.currentTarget.dataset.id;
  if(!dragId || targetId===dragId) return;
  const a=items.findIndex(x=>x.id===dragId);
  const b=items.findIndex(x=>x.id===targetId);
  if(a<0||b<0) return;
  const [m]=items.splice(a,1); items.splice(b,0,m);
  // rebuild list DOM
  els.list.innerHTML=''; items.forEach(addListItem);
}
function onDragEnd(e){ e.currentTarget.classList.remove('dragging'); dragId=null; }

/* ============ Options bindings ============ */
els.quality.addEventListener('input', ()=> els.qLabel.textContent = els.quality.value);

/* ============ Convert ============ */
els.convert.addEventListener('click', async ()=>{
  if(items.length===0) return alert('Please add images first.');
  setStatus('Converting '+items.length+' image(s)...');
  converted.clear(); els.convList.innerHTML='';
  for(let i=0;i<items.length;i++){
    const it = items[i];
    const out = await convertOne(it, i+1, items.length);
    converted.set(it.id, out);
    setStatus(`Converted ${i+1}/${items.length}`);
  }
  setStatus('Done');
  renderConvertedList();
});

async function convertOne(it, idx, total){
  const fmt=els.format.value; const ext=extOf(fmt);
  const scale=parseFloat(els.scale.value)||1;
  const color=els.bg.value;

  // prepare image
  const img = await loadImageForCanvas(it);
  const w=Math.max(1, Math.round(img.width*scale));
  const h=Math.max(1, Math.round(img.height*scale));

  const cvs=document.createElement('canvas'); cvs.width=w; cvs.height=h;
  const ctx=cvs.getContext('2d');

  // Fill background for JPG (no alpha). Also allow user to force solid bg for PNG if desired.
  if(fmt==='jpeg' || (fmt==='png' && color && color.toLowerCase()!=='#00000000')){
    ctx.fillStyle=color; ctx.fillRect(0,0,w,h);
  }
  ctx.drawImage(img,0,0,w,h);

  let blob;
  if(fmt==='png'){
    blob = await new Promise(res=> cvs.toBlob(res,'image/png'));
  }else{
    const q=Math.max(0.01, +els.quality.value/100);
    blob = await new Promise(res=> cvs.toBlob(res,'image/jpeg', q));
  }

  const namePat = els.namePattern.value || '{name}-{i}';
  const safeBase = baseName(it.name).replace(/[^\w\-]+/g,'_') || 'image';
  const filename = namePat.replace('{i}', idx).replace('{n}', total).replace('{name}', safeBase) + '.' + ext;

  return { blob, filename, url: URL.createObjectURL(blob) };
}

// Prefer ImageBitmap (honors EXIF orientation in many browsers), fallback to HTMLImageElement.
async function loadImageForCanvas(it){
  if(it.imgBitmap){ return it.imgBitmap; }
  return new Promise((res,rej)=>{
    const img=new Image();
    img.onload=()=>res(img);
    img.onerror=rej;
    img.src=it.dataURL;
  });
}

/* ============ Preview current as converted (quick view) ============ */
els.list.addEventListener('click', (e)=>{
  const row=e.target.closest('.item'); if(!row) return;
  const id=row.dataset.id;
  const it=items.find(x=>x.id===id); if(!it) return;
  current=id; showPreview(it.dataURL);
});

/* ============ Download actions ============ */
els.dlCurrent.addEventListener('click', async ()=>{
  if(!current){ return alert('Select an image from the list first.'); }
  // ensure converted cache
  if(!converted.has(current)){
    const idx = items.findIndex(x=>x.id===current);
    const out = await convertOne(items[idx], idx+1, items.length);
    converted.set(current, out); renderConvertedList();
  }
  const out = converted.get(current);
  saveAs(out.blob, out.filename);
});

els.dlAll.addEventListener('click', async ()=>{
  if(items.length===0) return alert('No images.');
  // convert all if needed then download one by one
  for(let i=0;i<items.length;i++){
    const it = items[i];
    if(!converted.has(it.id)){
      const out = await convertOne(it, i+1, items.length);
      converted.set(it.id, out);
    }
    const out = converted.get(it.id);
    saveAs(out.blob, out.filename);
  }
});

els.dlZip.addEventListener('click', async ()=>{
  if(items.length===0) return alert('No images to zip.');
  setStatus('Preparing ZIP...');
  const zip=new JSZip();
  // ensure all converted
  for(let i=0;i<items.length;i++){
    const it = items[i];
    if(!converted.has(it.id)){
      const out = await convertOne(it, i+1, items.length);
      converted.set(it.id, out);
    }
  }
  for(let i=0;i<items.length;i++){
    const it = items[i]; const out=converted.get(it.id);
    zip.file(out.filename, out.blob);
  }
  const blob = await zip.generateAsync({type:'blob'});
  saveAs(blob, 'images.zip');
  setStatus('ZIP ready');
});

/* ============ Converted list UI ============ */
function renderConvertedList(){
  els.convList.innerHTML='';
  const order = items.map(x=>x.id).filter(id=>converted.has(id));
  if(order.length===0){ els.convList.innerHTML='<div class="muted">No converted files yet</div>'; return; }
  order.forEach(id=>{
    const it = items.find(x=>x.id===id), out = converted.get(id);
    const row=document.createElement('div'); row.className='list-row';
    const left=document.createElement('div'); left.textContent = out.filename;
    const right=document.createElement('div');
    const a=document.createElement('button'); a.className='btn small'; a.textContent='Download';
    a.onclick=()=> saveAs(out.blob, out.filename);
    right.appendChild(a);
    row.appendChild(left); row.appendChild(right);
    els.convList.appendChild(row);
  });
}

/* ============ Clear ============ */
els.clear.addEventListener('click', ()=>{
  items.splice(0, items.length);
  els.list.innerHTML=''; els.count.textContent='0';
  converted.clear(); els.convList.innerHTML='';
  current=null; els.preview.classList.add('hidden'); els.placeholder.classList.remove('hidden');
  qs('#fileInput').value='';
  setStatus('Cleared');
});

/* ============ Small saveAs helper (FileSaver fallback) ============ */
function saveAs(blob, name){
  if(window.saveAs){ window.saveAs(blob, name); return; }
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name;
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
}
</script>
</body>
</html>
