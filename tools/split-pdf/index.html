<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Split PDF Pages — Smarttool Hub</title>
<link rel="icon" type="image/png" href="https://img.icons8.com/fluency/48/toolbox.png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
:root{
  --bg:#121826;--card:#1e293b;--muted:#94a3b8;--text:#fff;
  --pri1:#6366f1;--pri2:#0ea5e9
}
body{font-family:Arial,sans-serif;background:var(--bg);color:var(--text);margin:0}
header{background:linear-gradient(90deg,var(--pri1),var(--pri2));padding:15px 20px;display:flex;align-items:center;justify-content:space-between}
header .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff}
header .logo img{width:40px;height:40px;border-radius:8px}
header h1{margin:0;font-size:1.6rem}
header .tagline{color:#e0f2fe;font-size:0.95rem;font-style:italic}
header a.home{color:#fff;text-decoration:none;font-weight:bold}
.container{max-width:1100px;margin:20px auto;padding:18px}
.card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.35)}
.title{display:flex;align-items:center;gap:10px;margin:0 0 10px}
.subtitle{color:var(--muted);margin:0 0 16px}
.btn{display:inline-flex;align-items:center;gap:8px;border:none;cursor:pointer;padding:10px 14px;border-radius:10px;background:var(--pri1);color:#fff;font-weight:600}
label.btn{cursor:pointer}
#fileInput{display:none}
.drop{border:2px dashed var(--pri2);border-radius:12px;padding:28px;text-align:center;margin:12px 0}
.drop.drag{border-color:#fff;background:#0b1220}
.pages{display:grid;grid-template-columns:repeat(auto-fill,120px);gap:12px;margin-top:20px}
.page-thumb{border:2px solid transparent;border-radius:8px;cursor:pointer;overflow:hidden;background:#0b1220}
.page-thumb img{width:100%;display:block}
.page-thumb.selected{border-color:var(--pri2)}
footer{background:linear-gradient(90deg,#0f172a,var(--pri2));color:#94a3b8;text-align:center;padding:20px;margin-top:30px;font-size:13px}
footer a{color:#fff;text-decoration:none}
</style>
</head>
<body>
<header>
  <a class="logo" href="../../index.html">
    <img src="https://img.icons8.com/fluency/48/toolbox.png"/>
    <div>
      <h1>Smarttool Hub</h1>
      <div class="tagline">Powerful, Free, and Instant Tools for Everyone</div>
    </div>
  </a>
  <a class="home" href="../../index.html"><i class="fa fa-home"></i> All Tools</a>
</header>

<div class="container">
  <div class="card">
    <h2 class="title"><i class="fa fa-scissors"></i> Split PDF Pages</h2>
    <p class="subtitle">Upload a PDF, select the pages you want, and export them as a new file.</p>

    <label class="btn"><i class="fa fa-file-arrow-up"></i> Select PDF
      <input id="fileInput" type="file" accept=".pdf,application/pdf">
    </label>

    <div id="dropZone" class="drop">
      <i class="fa fa-cloud-arrow-up"></i> Drag & Drop PDF here
    </div>

    <div id="pages" class="pages"></div>

    <div style="margin-top:15px;display:none" id="actionButtons">
      <button id="toggleSelectAllBtn" class="btn"><i class="fa fa-check-double"></i> Select All Pages</button>
      <button id="exportBtn" class="btn" style="display:none"><i class="fa fa-download"></i> Export Selected Pages</button>
    </div>
  </div>
</div>

<footer>
  © 2025 Smarttool Hub — <a href="../../index.html">Back to Home</a>
</footer>

<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
<!-- Primary PDF.js v3 -->
<script id="pdfjs-primary" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<!-- Fallback PDF.js v2 -->
<script id="pdfjs-fallback" src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js" defer></script>

<script>
let pdfjsVersion = 3; // Start with primary
let fileBytes=null, pdfDoc=null, allSelected=false;

function setupWorker() {
  if(pdfjsVersion===3){
    pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
  } else {
    pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
  }
}
setupWorker();

const input=document.getElementById('fileInput');
const drop=document.getElementById('dropZone');
const pagesDiv=document.getElementById('pages');
const exportBtn=document.getElementById('exportBtn');
const toggleSelectAllBtn=document.getElementById('toggleSelectAllBtn');
const actionButtons=document.getElementById('actionButtons');

input.addEventListener('change',e=>{ if(e.target.files.length) loadPDF(e.target.files[0]); });
['dragover','dragenter'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.add('drag');}));
['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.remove('drag');}));
drop.addEventListener('drop',e=>{ if(e.dataTransfer.files.length) loadPDF(e.dataTransfer.files[0]); });

async function loadPDF(file){
  if(!file.name.toLowerCase().endsWith('.pdf')) return alert('Only PDFs allowed');
  fileBytes = await file.arrayBuffer();
  try{
    const loadingTask=pdfjsLib.getDocument({data:fileBytes});
    pdfDoc=await loadingTask.promise;
    renderThumbnails();
  }catch(err){
    console.warn("Primary method failed, switching to fallback...", err);
    if(pdfjsVersion===3){
      pdfjsVersion=2;
      setupWorker();
      setTimeout(()=>loadPDF(file),500);
    } else {
      alert("Error loading PDF even in fallback mode.");
    }
  }
}

async function renderThumbnails(){
  pagesDiv.innerHTML='';
  for(let p=1;p<=pdfDoc.numPages;p++){
    const page=await pdfDoc.getPage(p);
    const viewport=page.getViewport({scale:0.3});
    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    canvas.height=viewport.height;
    canvas.width=viewport.width;
    await page.render({canvasContext:ctx,viewport}).promise;
    const thumb=document.createElement('div');
    thumb.className='page-thumb';
    thumb.dataset.page=p;
    thumb.innerHTML=`<img src="${canvas.toDataURL()}"><div style="text-align:center;font-size:12px;color:#ccc">${p}</div>`;
    thumb.addEventListener('click',()=>{
      thumb.classList.toggle('selected');
      updateSelectedPages();
    });
    pagesDiv.appendChild(thumb);
  }
  actionButtons.style.display='block';
  updateSelectedPages();
}

function updateSelectedPages(){
  const selectedThumbs=document.querySelectorAll('.page-thumb.selected');
  const selectedPages=Array.from(selectedThumbs).map(t=>parseInt(t.dataset.page)).sort((a,b)=>a-b);
  exportBtn.style.display=selectedPages.length?'inline-flex':'none';
  return selectedPages;
}

toggleSelectAllBtn.addEventListener('click',()=>{
  const thumbs=document.querySelectorAll('.page-thumb');
  if(!allSelected){
    thumbs.forEach(thumb=>thumb.classList.add('selected'));
    allSelected=true;
    toggleSelectAllBtn.innerHTML='<i class="fa fa-times-circle"></i> Deselect All Pages';
  } else {
    thumbs.forEach(thumb=>thumb.classList.remove('selected'));
    allSelected=false;
    toggleSelectAllBtn.innerHTML='<i class="fa fa-check-double"></i> Select All Pages';
  }
  updateSelectedPages();
});

exportBtn.addEventListener('click',async()=>{
  const selectedPages=updateSelectedPages();
  if(!selectedPages.length) return alert('Select pages to export!');
  try{
    const loadingTask = pdfjsLib.getDocument({ data: fileBytes });
    const srcDoc = await loadingTask.promise;
    const newPdf = await PDFLib.PDFDocument.create();

    for (const p of selectedPages) {
      const page = await srcDoc.getPage(p);
      const viewport = page.getViewport({ scale: 1 });
      const tempCanvas = document.createElement("canvas");
      const ctx = tempCanvas.getContext("2d");
      tempCanvas.height = viewport.height;
      tempCanvas.width = viewport.width;
      await page.render({ canvasContext: ctx, viewport }).promise;
      const imgBytes = tempCanvas.toDataURL("image/png");
      const imgEmbed = await newPdf.embedPng(imgBytes);
      const pagePdf = newPdf.addPage([viewport.width, viewport.height]);
      pagePdf.drawImage(imgEmbed, { x: 0, y: 0, width: viewport.width, height: viewport.height });
    }

    const pdfBytes = await newPdf.save();
    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'split.pdf';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);

  }catch(err){
    alert('Failed to split PDF. This file may still be corrupted.');
    console.error(err);
  }
});
</script>
</body>
</html>
